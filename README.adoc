= Asciidoctor Tools
:toc: left
:toclevels: 5
:highlightjs-theme: monokai
:imagesdir: docs/images
:themes:

While code documentation generation and publishing to e.g. Github pages, using static page generation tools, it is often desirable to get docu rendered directly within the repository browser:

- You do not need to set up a build pipeline only to get documentation online
- Version support is being delivered by definition (since yes, docu should stay with the code)
- Access control is already set up for the code browser, so comes out of the box. This is not always desired but in most cases it is, especially when docu links directly into the source.


Repo browsing frontends often do support limitted rendering of common text formats, like `.md`, `.rst` or, as you can see, also asciidoctor, `.adoc`.

This project tries to help make the viewing experience a bit better, for the https://asciidoctor.org/docs/asciidoc-syntax-quick-reference[`.adoc` format].


== The Asciidoctor Browser Extension

When you see raw https://asciidoctor.org[asciidoctor] source in your browser, then either you are viewing a local file or the server did not render it:

[frame=topbot]
image::adocraw.png[asciidoc raw, 400 role=related thumb right]

What you probably *want* to see instead is something like this:

[frame=sides]
image::rendered.png[asciidoc rendered,400]


This comes to rescue: +
https://github.com/asciidoctor/asciidoctor-browser-extension[asciidoctor/asciidoctor-browser-extension: An extension for web browsers that converts AsciiDoc files to HTML using Asciidoctor.js.]

As described there, the extension is available for chrome, ff and opera.

IMPORTANT: Install the extension and your *browser* will take care of the rendering, using a javascript port of asciidoctor.

NOTE: In repository browsers, you have to view the page as raw in order to get it rendered. +
Means: Click the `raw view` button. +
On github: image:raw.png[raw, 60]



== Custom Script

=== Added Value 

The extension allows to hook in custom javascript.

This repo provides such a script, which adds support for

- `:toc: left`, support - i.e. a fixed table of contents on the left side, useful for longer documents
- a https://darshandsoni.com/asciidoctor-skins/screenshots/[bigger] variety of default themes
- theme switchers and query string support for `?theme=<theme name>`
- any code https://highlightjs.org/[hilightjs] theme



=== Installation

1. Download script into any local directory:

[source,bash]
----
wget https://raw.githubusercontent.com/axiros/adoctools/master/browser/ax-adoc-chrome.js
----

2. Configure the extension to use it:

[cols="1,1"]
.Extension config
|===
|image:cfg1.png[]
|image:cfg.png[]
|===

NOTE: We set `toc=left` always, this is optional.

Thats it. You get two theme selector boxes, one for code style and one for the asciidoctor skin.

.Examples (raw view of .adoc sources in the browser with varying selected themes)
|===
|image:ex_ma_teal.png[dark, 400]| image:ex_noteboo.png[dark, 400]
|image:ex_boot_sl.png[dark, 400]| image:ex_gazette.png[dark, 400]
|image:fed.png[fedora, 400]     | image:dark.png[dark, 400]
|===

* You have quite a few variations regarding style - see link:server/asciidoctor/index.txt[here].
* All adoc themes taken from https://github.com/darshandsoni/asciidoctor-skins[darshandsoni/asciidoctor-skins], unmodified (but a bit tweaked using our JS, e.g. for the side toc)
* All code themes from https://highlightjs.org[hilightjs]

TIP: To cycle through themes, hit `Alt-s` or `Alt-c` to focus, then arrow up or down.

=== Configuration

None - the file works standalone. Adapt the link:browser/ax-adoc-chrome.js[source] to your liking.

=== Security

* The file is injected as page script by the extension, i.e. has the same restrictions as any javascript.
* The extension does not offer a messaging channel currently, i.e. there is no communication with the extension. Means we cannot modify the source *before* rendering - only the HTML after rendering, like any javascript.

NOTE: Nevertheless we hook in in _prerender_ phase, in order to see set attributes while we have the source.


=== Known Problems / TODOs

==== Sandboxed mode

Some servers deliver the source in sandboxed mode - e.g. github(!). Then the custom JS is running limitted:

.console output
[source]
----
Blocked script execution in 'https://raw.githubusercontent.com/asciidoctor/asciidoctor-browser-extension/master/README.adoc' because the document's frame is sandboxed and the 'allow-scripts' permission is not set.
----

Fortunatelly at least the syncronous style rewrites necessary for the side toc do work:

E.g. for https://raw.githubusercontent.com/axiros/adoctools/master/README.adoc[this document] you get something like:


image:gh.png[gh, 400,300]

https://raw.githubusercontent.com/asciidoctor/asciidoctor.org/master/docs/_includes/table-formatting.adoc[Here] is another example to try - again you should see the sidebar toc:


image:ex2.png[example2, 400,300]

We can *not* inject custom styles into the document though, i.e. the page will be rendered using the style which is configured in the extension incl. its code style.

==== No TOC

When the original document does not set a toc attribute, we do not produce one (did not want to manually recurse over Hx tags in the DOM).

Solution: Configure `toc=left` in the Extension, like suggested in the screenshot above, i.e. tell asciidoctor to always produce one.

==== Sporadic Rendering Errors

Some styles do not define all attributes, especially the bootstrap derived ones.
Then your extension's set stylesheet's css "leaks" into the document, since we cannot prevent the extension to insert the default stylesheet before we overwrite.

Workaround: Set the extension stylesheet to a rather neutral one, matching your preferences.


==== No offline mode

Requires access to server.

Currently the script is not storing the themes locally explicitely, but pulls them from a configurable server (default: This github repo), which would not work offline.

Workaround: You can throw them on any static webserver within your premises or on your localhost. Configuration is in the source of this script:

[source,javascript]
----
var SERVER_URL = <your url>
----

CAUTION: Reload the script within the extension config after changes.


